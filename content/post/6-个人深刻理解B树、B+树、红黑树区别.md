+++
title = "6-个人深刻理解B树、B+树、红黑树区别"
date = 2020-04-12T15:50:10+01:00
lastmod = 2020-04-12T16:50:10+01:00
draft = false
tags = ["树"]
categories = ["树"]
type = ["archives"]
+++

# 6-个人深刻理解B树、B+树、红黑树区别

## 个人心得体会，切勿模仿

最近面试，总会被问道mysql索引，然后随之而来就是为什么用这种树而不用别的之类的问题，本来自己之前对这部分知识有所积累和了解，但是当面试完的时候，反思了一些，每次回答总有一些不完善的地方，回顾了好多博客，发现个别点，自己总是会忽略掉，以为自己知道了，所以趁自己脑细胞还活跃，赶紧记录，以备参考。

### B树 B+树，
主要区别，
- 1. B树每个节点都会存储数据（比如是磁盘物理地址，或者就是数据本身），B+树每个节点不会存储数据，只存储索引，那么数据在哪存储呢？全部存储到了叶子节点。
- 2. 由1可知，这两种存储方式就会导致在查询和每页存储数据量以及整个结构多少多少都会有一些区别的。

   - 2.1 查询上，B树，查询某个数据，并不需要遍历完整颗树，而只需要查询到索引本身就可以取出数据；B+树呢，就需要一直遍历到叶子节点，才会取出具体的数据，所以两者在查询性能上是有差异的，一个不稳定一个稳定。
  
   - 2.2 存储上，由于B树，每个节点都会存储数据，这就导致每页存储的数据会减少（相对B+树），而树的高度增加，而B+树，每页则可以存储更多的数据，从而使树的高度降低，因为树的高度增加，就会导致磁盘IO次数增加，而磁盘IO又十分耗时，所以树的高度越低，就可以减少磁盘IO，对于查询性能的提升有非常大的帮助。
  
   - 2.3 叶子节点的存储方式不同，由于B树的存储方式，就导致B树结构存储是松散的，而B+树，所有的索引和数据都在叶子节点，所以B+树，通过在叶子节点增加链表，则可以使所有叶子节点形成了一个有序链表，这在范围查询和局部性上都提供了极大的遍历。


### 红黑树
红黑树是一个AVL树，在内存排序用的相对多些，而基本上不会在磁盘存储上使用，最主要的原因就是红黑树的高度很高，不适合磁盘这种的IO操作。还有修改树，有可能导致树的旋转分裂，对于磁盘操作成本也都很高。

还有一个小问题，是最近【https://www.cs.usfca.edu/~galles/visualization/Algorithms.html】 通过这个网站，可以直观的看到各种树的变化，实验了下红黑树的变化，发现如果是递增索引的话，前几次操作都是向右有倾斜的，不过毕竟是一颗平衡树，这个倒不是什么大问题。不过通过直观的看到，还是有一些收获的。

### 面试吐槽
写的时候，想起来之前一个高德面试官（吐槽下，个人感觉这个面试官真的有点看不起人，当时自己都不想继续聊了，和问的这个问题无关。）问的一个问题，如果有办法可以使树的高度尽可能降低，比如就两层，查询效率会不会更高（感觉这个问题挺好），面试时，个人压力大也没怎么想明白，我就简单的回答了理论上会吧，主要说了高度高了，肯定会降低磁盘io，然后还说了可能每页数据会存储更多，可能会导致内存加载数据太多之类的，面试官当时也很不屑，我也不知道对不对。

后来面完想了下，我觉得我说的也没太大问题。无非也就是这两点，磁盘和内存。树就规定好了两层，没什么好说的，内存呢，要知道，mysql 是怎么查询索引，实际mysql， 确实会把数据加载到内存，然后在去二分查找，定位到索引的下个节点。最后找到叶子节点。

不过现在想了想，可能还真没那么简单，比如是有序还是无序的索引，新增，删除，这个树的变化，会不会有其他的问题，我还是没太想明白。欢迎各路大神指点迷津。

下面是另一个funplus面试官提到的一个点，说是mysql 的索引都是常驻内存的？这个我搜了很多也没找到结论，我个人了解，只是有局部性原理的存在，所有索引都常驻内存，我当时就觉得不对，现在想想，感觉更不对，如果好几个表建了N多索引，这TM内存不爆了。。。





# Hello World!